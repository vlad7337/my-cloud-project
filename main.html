<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Event Planner | GitHub API</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
        <div class="bg-blue-600 p-6">
            <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                <span>üìÖ</span> –•–º–∞—Ä–Ω–∏–π –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫
            </h1>
            <p class="text-blue-100 text-sm mt-1">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ GitHub API</p>
        </div>

        <div class="p-6">
            <div class="flex gap-2 mb-8">
                <input type="text" id="taskInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –ø–æ–¥—ñ—é —á–∏ –∑–∞–≤–¥–∞–Ω–Ω—è..." 
                       class="flex-1 border border-slate-300 rounded-lg px-4 py-2 outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                <button onclick="addTask()" 
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 active:transform active:scale-95 transition-all">
                    –î–æ–¥–∞—Ç–∏
                </button>
            </div>

            <div class="space-y-4">
                <h2 class="text-lg font-semibold text-slate-700 flex justify-between">
                    –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω—ñ–≤
                    <span id="loadingSpinner" class="hidden animate-spin">‚è≥</span>
                </h2>
                <ul id="taskList" class="space-y-3">
                    </ul>
            </div>

            <div class="mt-10 pt-6 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-2">
                    <div id="statusIndicator" class="w-3 h-3 rounded-full bg-green-500"></div>
                    <span id="statusText" class="text-sm text-slate-600 font-medium">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ —Ö–º–∞—Ä–æ—é</span>
                </div>
                <div class="flex gap-4">
                    <button onclick="fetchFromGitHub()" class="text-xs text-blue-600 hover:text-blue-800 font-medium">–û–Ω–æ–≤–∏—Ç–∏ –∑ –ë–î</button>
                    <button onclick="exportToJSON()" class="text-xs text-slate-400 hover:text-slate-600">–°–∫–∞—á–∞—Ç–∏ .json</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø GITHUB (–ó–ê–ü–û–í–ù–Ü–¢–¨ –°–í–û–á –î–ê–ù–Ü) ---
        const CONFIG = {
            owner: 'vlad7337', 
            repo: 'my-cloud-project',
            path: 'data/tasks.json'
        };

        let tasks = [];

        // 1. –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –î–ê–ù–ò–• –ü–†–ò –ó–ê–ü–£–°–ö–£
        async function fetchFromGitHub() {
            updateStatus('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', 'bg-yellow-500');
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`, {
                    headers: { 'Authorization': `token ${CONFIG.token}` }
                });
                const data = await response.json();
                // –î–µ–∫–æ–¥—É—î–º–æ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É –∑ Base64
                const content = atob(data.content);
                tasks = JSON.parse(content);
                renderTasks();
                updateStatus('–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ', 'bg-green-500');
            } catch (error) {
                console.error('Error fetching:', error);
                updateStatus('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è', 'bg-red-500');
            }
        }

        // 2. –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –í GITHUB (COMMIT)
        async function saveToGitHub() {
            const statusEl = document.getElementById('statusText');
            statusEl.innerText = "–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –¥–æ GitHub Actions...";
            
            // –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ prompt (—è–∫—â–æ –π–æ–≥–æ —â–µ –Ω–µ–º–∞—î –≤ —Å–µ—Å—ñ—ó)
            let sessionToken = sessionStorage.getItem('gh_token');
            if (!sessionToken) {
                sessionToken = prompt("–í–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥—ñ—ó:");
                sessionStorage.setItem('gh_token', sessionToken);
            }
        
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${sessionToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        event_type: 'update-tasks', // –º–∞—î –∑–±—ñ–≥–∞—Ç–∏—Å—è –∑ "types" —É .yml
                        client_payload: {
                            tasks: JSON.stringify(tasks, null, 2)
                        }
                    })
                });
        
                if (response.ok) {
                    statusEl.innerText = "Action –∑–∞–ø—É—â–µ–Ω–æ! –î–∞–Ω—ñ –æ–Ω–æ–≤–ª—è—Ç—å—Å—è –∑–∞ 15-20 —Å–µ–∫.";
                } else {
                    throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É Action');
                }
            } catch (error) {
                statusEl.innerText = "–ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ Action ‚ùå";
            }
        }

        function renderTasks() {
            const list = document.getElementById('taskList');
            list.innerHTML = '';
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center bg-slate-50 p-4 rounded-xl border border-slate-100 hover:border-blue-200 transition-colors group";
                li.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-slate-800 font-medium">${task.text}</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider">${new Date(task.date).toLocaleDateString()}</span>
                    </div>
                    <button onclick="deleteTask(${index})" class="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 transition-all p-2">
                        –í–∏–¥–∞–ª–∏—Ç–∏
                    </button>
                `;
                list.appendChild(li);
            });
        }

        async function addTask() {
            const input = document.getElementById('taskInput');
            if (input.value.trim() !== '') {
                tasks.push({ 
                    text: input.value, 
                    date: new Date().toISOString() 
                });
                input.value = '';
                renderTasks();
                await saveToGitHub(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —à—Ç–æ–≤—Ö–∞—î–º–æ –≤ —Ö–º–∞—Ä—É
            }
        }

        async function deleteTask(index) {
            tasks.splice(index, 1);
            renderTasks();
            await saveToGitHub();
        }

        function updateStatus(text, colorClass) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            indicator.className = `w-3 h-3 rounded-full ${colorClass}`;
            statusText.innerText = text;
        }

        function exportToJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(tasks, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "cloud_tasks.json");
            downloadAnchorNode.click();
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        fetchFromGitHub();
    </script>
</body>
</html>
